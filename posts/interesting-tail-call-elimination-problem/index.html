<!doctype html>
<html data-n-head-ssr lang="vi" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22vi%22%7D%7D">
  <head>
    <meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="og:image" property="og:image" content="https://balldk.github.io/meta-img.png"><meta data-n-head="ssr" data-hid="og:site_name" property="og:site_name" content="GÃ³c nhá» cá»§a K"><meta data-n-head="ssr" data-hid="description" name="description" content="Má»™t bÃ i toÃ¡n thÃº vá»‹ vá» tá»‘i Æ°u Ä‘á»‡ quy giÃºp tui cÃ³ gÃ³c nhÃ¬n khÃ¡c vá» tail call elimination nhÆ° tháº¿ nÃ o."><meta data-n-head="ssr" data-hid="og:title" property="og:title" content="GÃ³c nhÃ¬n khÃ¡c vá» tail call elimination | GÃ³c nhá» cá»§a K"><meta data-n-head="ssr" data-hid="og:description" property="og:description" content="Má»™t bÃ i toÃ¡n thÃº vá»‹ vá» tá»‘i Æ°u Ä‘á»‡ quy giÃºp tui cÃ³ gÃ³c nhÃ¬n khÃ¡c vá» tail call elimination nhÆ° tháº¿ nÃ o."><meta data-n-head="ssr" data-hid="keywords" name="keywords" content="algorithm, recursion, functional-programming"><meta data-n-head="ssr" data-hid="og:type" property="og:type" content="article"><title>GÃ³c nhÃ¬n khÃ¡c vá» tail call elimination | GÃ³c nhá» cá»§a K</title><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/logo.svg"><link data-n-head="ssr" rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous"><link data-n-head="ssr" rel="preconnect" href="https://fonts.googleapis.com"><link data-n-head="ssr" rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Signika:wght@300;400;500;600;700&display=swap"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"><link data-n-head="ssr" rel="stylesheet" href='https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"'><link data-n-head="ssr" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous"><script data-n-head="ssr" async src="https://www.googletagmanager.com/gtag/js?id=G-SH612LCBTQ"></script><link rel="preload" href="/_nuxt/2d9de3f.js" as="script"><link rel="preload" href="/_nuxt/8538b13.js" as="script"><link rel="preload" href="/_nuxt/css/04e2415.css" as="style"><link rel="preload" href="/_nuxt/0a5dc33.js" as="script"><link rel="preload" href="/_nuxt/css/f597ee7.css" as="style"><link rel="preload" href="/_nuxt/761ab04.js" as="script"><link rel="preload" href="/_nuxt/css/e4d0367.css" as="style"><link rel="preload" href="/_nuxt/a041fa1.js" as="script"><link rel="preload" href="/_nuxt/2724976.js" as="script"><link rel="preload" href="/_nuxt/2d0a0ae.js" as="script"><link rel="stylesheet" href="/_nuxt/css/04e2415.css"><link rel="stylesheet" href="/_nuxt/css/f597ee7.css"><link rel="stylesheet" href="/_nuxt/css/e4d0367.css"><link rel="preload" href="/_nuxt/static/1685628949/posts/interesting-tail-call-elimination-problem/state.js" as="script"><link rel="preload" href="/_nuxt/static/1685628949/posts/interesting-tail-call-elimination-problem/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1685628949/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><article><div class="head-bar"><div class="post-logo-container"><a href="/" class="post-logo logo nuxt-link-active"></a></div></div> <div class="post-container"><!----> <div class="post-content-container"><div class="post-header"><h1 class="post-title">GÃ³c nhÃ¬n khÃ¡c vá» tail call elimination</h1> <p class="post-info"><i class="far fa-edit"></i> ÄÄƒng vÃ o 2-9-2021</p> <p class="post-info"><i class="far fa-clock"></i> 10 phÃºt Ä‘á»c</p> <!----></div> <div class="post-content"><p>Tui thÃ¬ Ä‘Ã³ giá» hay cÃ y rank trÃªn <a href="https://www.codewars.com">Codewars</a>, chá»§ yáº¿u lÃ  vÃ¬ giao diá»‡n cá»§a nÃ³ ngáº§u lÃ²i hÆ¡n ba máº¥y web thuáº­t toÃ¡n chÃ¡n ngáº¯t khÃ¡c ğŸ˜„ ChÆ¡i má»™t thá»i gian thÃ¬ tui cÅ©ng lÃªn Ä‘Æ°á»£c 4 kyu vÃ  gáº·p pháº£i bÃ i toÃ¡n nÃ y <a href="https://www.codewars.com/kata/57040e445a726387a1001cf7">The fusc function - Part 2</a>. BÃ i nÃ y thÃº vá»‹ á»Ÿ chá»—, thay vÃ¬ nhÆ° thÃ´ng thÆ°á»ng há» chá»‰ Ä‘Æ°a mÃ¬nh Ä‘á» bÃ i, thÃ¬ bÃ i nÃ y há» cÃ²n Ä‘Æ°a cho mÃ¬nh má»™t bÃ i khÃ¡c vÃ­ dá»¥ máº«u cho phÆ°Æ¡ng phÃ¡p mÃ  há» muá»‘n mÃ¬nh dÃ¹ng. NÃ³i chung lÃ  giáº£i xong sáº½ há»c Ä‘Æ°á»£c phÆ°Æ¡ng phÃ¡p gÃ¬ Ä‘Ã³ má»›i, chá»‰ tiáº¿c lÃ  tui lÃºc Ä‘Ã³ Ä‘Ã£ quyáº¿t Ä‘á»‹nh gáº­p mÃ¡y Ä‘i ngá»§ ğŸ™‚ Má»›i Ä‘áº§u nÄƒm nay thÃ¬ tui thá»­ má»Ÿ ra lÃ m láº¡i, vÃ  congrats, nÃ£o tui Ä‘Ã£ Ä‘Æ°á»£c thÃ´ng, giá» tui Ä‘i thÃ´ng ngÆ°á»£c láº¡i cho máº¥y báº¡n Ä‘Ã¢y.</p>
<p>Trong bÃ i viáº¿t nÃ y, tui sáº½ Ä‘i giáº£i quyáº¿t bÃ i toÃ¡n trÃªn trÆ°á»›c, má»¥c tiÃªu bÃ i toÃ¡n lÃ  Ä‘Æ°a tá»« má»™t hÃ m Ä‘á»‡ quy thÃ nh má»™t hÃ m Ä‘á»‡ quy Ä‘uÃ´i (tail call elimination), Ä‘á»«ng lo, tui sáº½ giáº£i thÃ­ch kÄ© hÆ¡n nhá»¯ng thuáº­t ngá»¯ nÃ y á»Ÿ phÃ­a dÆ°á»›i. Sau Ä‘Ã³ tui sáº½ chia sáº» má»™t chÃºt vá» gÃ³c nhÃ¬n cá»§a tui táº¡i sao phÆ°Æ¡ng phÃ¡p cá»§a bÃ i toÃ¡n nÃ y khÃ¡ Ä‘á»™c Ä‘Ã¡o so vá»›i thá»±c táº¿. Okay triá»ƒn thÃ´i nÃ o!</p>
<h2>Ná»™i dung bÃ i toÃ¡n</h2>
<p>DÃ nh cho nhá»¯ng con ngÆ°á»i chÃ¢y lÆ°á»i khÃ´ng chá»‹u báº¥m vÃ o link Ä‘á»c trÆ°á»›c (á»«a tui Ä‘ang nÃ³i báº¡n Ä‘Ã³) thÃ¬ tui sáº½ trÃ¬nh bÃ y láº¡i bÃ i toÃ¡n á»Ÿ Ä‘Ã¢y luÃ´n, <del>chá»© khÃ´ng pháº£i vÃ¬ tui muá»‘n bÃ i mÃ¬nh dÃ i ra Ä‘Ã¢u nha</del>. Vá»›i láº¡i tui cÅ©ng sáº½ lÃ m rÃµ má»™t sá»‘ chá»— mÃ  bÃ i viáº¿t gá»‘c khÃ´ng Ä‘á» cáº­p tá»›i.</p>
<p>Cho hÃ m <span class="math inline">\(\operatorname{fusc}(n)\)</span> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a nhÆ° sau:</p>
<p><span class="math display">\[\begin{cases}
\operatorname{fusc}(0) = 0\\
\operatorname{fusc}(1) = 1\\
\operatorname{fusc}(2n) = \operatorname{fusc}(n)\\
\operatorname{fusc}(2n + 1) = \operatorname{fusc}(n) + \operatorname{fusc}(n + 1)\\
\end{cases}
\]</span></p>
<p>Viá»‡c cá»§a báº¡n lÃ  hÃ£y viáº¿t láº¡i vÃ  tá»‘i Æ°u hÃ m <span class="math inline">\(\operatorname{fusc}(n)\)</span> trÃªn. Nhá»› ráº±ng <span class="math inline">\(n\)</span> sáº½ cÃ³ giÃ¡ trá»‹ ráº¥t lá»›n, cá»¥ thá»ƒ thÃ¬ <span class="math inline">\(n\)</span> sáº½ lá»›n hÆ¡n 1000 bit (Ä‘á»‘i vá»›i Javascript) vÃ  52 bit (Ä‘á»‘i vá»›i PHP), nÃªn lÃ  cáº§n lÆ°u Ã½ tá»›i váº¥n Ä‘á» stack overflow vÃ  timeouts.</p>
<h2>Gá»£i Ã½ phÆ°Æ¡ng phÃ¡p</h2>
<blockquote>
Pháº§n nÃ y trong lÃºc Ä‘á»c máº¥y báº¡n khÃ´ng cáº§n quÃ¡ hoang mang nhá»¯ng thá»© nhÆ° lÃ  táº¡i sao pháº£i Ä‘Æ°a hai váº¿ vá» cÃ¹ng dáº¡ng, rá»“i táº¡i sao pháº£i Ä‘áº·t thÃªm biáº¿n a, b cÃ¡c thá»© Ä‘Ã¢u, cá»© Ä‘á»c Ä‘áº¿n cuá»‘i lÃ  má»i thá»© sáº½ trá»Ÿ nÃªn make sense thÃ´i.
</blockquote>
<p>TÆ°á»Ÿng tÆ°á»£ng thay vÃ¬ Ä‘á» bÃ i lÃ  hÃ m <span class="math inline">\(\operatorname{fusc}(n)\)</span> mÃ  lÃ  hÃ m <span class="math inline">\(\operatorname{fib}(n)\)</span> (tráº£ vá» <a href="https://en.wikipedia.org/wiki/Fibonacci_number">sá»‘ Fibonacci</a> thá»© <span class="math inline">\(n\)</span>), thÃ¬ lÃºc nÃ y hÃ m Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a nhÆ° sau:</p>
<p><span class="math display">\[\begin{cases}
\operatorname{fib}(0) = 1 & (1)\\
\operatorname{fib}(1) = 1 & (2)\\
\operatorname{fib}(n + 2) = \operatorname{fib}(n) + \operatorname{fib}(n + 1)\quad (n \geq 0) & (3)
\end{cases}
\]</span></p>
<p>Náº¿u dÃ¹ng trá»±c tiáº¿p Ä‘á»‹nh nghÄ©a trÃªn thÃ¬ khÃ´ng Ä‘Æ°á»£c tá»‘i Æ°u cho láº¯m. DÄ© nhiÃªn báº¡n hoÃ n toÃ n cÃ³ thá»ƒ dÃ¹ng quy hoáº¡ch Ä‘á»™ng, nhÆ°ng lÃ m váº­y thÃ¬ láº¡i tá»‘n thÃªm bá»™ nhá»› khÃ´ng cáº§n thiáº¿t, nÃªn lÃ  chÃºng ta sáº½ cá»‘ thá»­ tÃ¬m Ä‘á»‡ quy Ä‘uÃ´i (<a href="https://www.geeksforgeeks.org/tail-recursion">tail recursion</a>) cho bÃ i toÃ¡n nÃ y.</p>
<blockquote>Láº¡i lÃ  gÃ³c nhá» cho nhá»¯ng con lÆ°á»i khÃ´ng chá»‹u báº¥m vÃ o Ä‘á»c trÆ°á»›c Ä‘á»‹nh nghÄ©a cá»§a tail recursion Ä‘Ã¢y, thÃ¬ tail recursion lÃ  loáº¡i hÃ m Ä‘á»‡ quy mÃ  viá»‡c gá»i Ä‘á»‡ quy lÃ  Ä‘iá»u cuá»‘i cÃ¹ng hÃ m Ä‘Ã³ thá»±c hiá»‡n. Láº¥y vÃ­ dá»¥:</blockquote>
<pre><code class="language-js">// ÄÃ¢y khÃ´ng lÃ  tail recursion vÃ¬ sau khi gá»i Ä‘á»‡ quy
// fact(n-1) thÃ¬ hÃ m pháº£i thá»±c hiá»‡n thÃªm phÃ©p nhÃ¢n
// vá»›i n ná»¯a má»›i káº¿t thÃºc
function fact(n) {
    if (n === 1)
        return 1
    else
        return n * fact(n-1)
}

// ÄÃ¢y lÃ  tail recursion vÃ¬ chá»‰ cáº§n gá»i fact(n-1, acc*n)
// xong thÃ¬ hÃ m sáº½ káº¿t thÃºc
function fact(n, acc) {
    if (n === 1)
        return acc
    else
        return fact(n-1, acc*n)
}
</code></pre>
<p>Báº¡n cÃ³ thá»ƒ tá»± tÃ¬m hiá»ƒu kÄ© hÆ¡n táº¡i sao khi Ä‘Æ°a vá» tail recursion thÃ¬ sáº½ tá»‘i Æ°u hÆ¡n, nhÆ°ng Ä‘á»ƒ nÃ³i sÆ¡ qua thÃ¬ bÃ¬nh thÆ°á»ng khi báº¡n gá»i Ä‘á»‡ quy, nhá»¯ng giÃ¡ trá»‹, Ã´ nhá»› cÃ¡c thá»© á»Ÿ hiá»‡n táº¡i sáº½ Ä‘Æ°á»£c Ä‘áº©y lÃªn call stack, cá»© má»—i láº§n gá»i Ä‘á»‡ quy lá»“ng nhau thÃ¬ call stack sáº½ cÃ ng ngÃ y cÃ ng cao lÃªn, bá»™ nhá»› phÃ¬nh to ra, cho Ä‘áº¿n khi vÆ°á»£t quÃ¡ call stack size thÃ¬ chÆ°Æ¡ng trÃ¬nh tráº£ vá» lá»—i stack overflow. Tail recursion thÃ¬ láº¡i khÃ¡c, vÃ¬ Ä‘á»‡ quy lÃ  cÃ¢u lá»‡nh Ä‘Æ°á»£c thá»±c hiá»‡n cuá»‘i cÃ¹ng nÃªn compiler sáº½ thoáº£i mÃ¡i giáº£i phÃ³ng stack hiá»‡n táº¡i vÃ¬ nÃ³ cháº¯c cháº¯n stack hiá»‡n táº¡i khÃ´ng cáº§n dÃ¹ng ná»¯a, nÃªn dÃ¹ cÃ³ gá»i Ä‘á»‡ quy vÃ´ háº¡n láº§n thÃ¬ cÅ©ng khÃ´ng lo bá»‹ stack overflow.</p>
<p>Tiáº¿p tá»¥c nhÃ©, bÃ¢y giá» Ä‘á»ƒ biáº¿n <span class="math inline">\(\operatorname{fib}(n)\)</span> thÃ nh tail recursion, ta láº¥y phÆ°Æ¡ng trÃ¬nh <span class="math inline">\((3)\)</span> Ä‘em biáº¿n Ä‘á»•i thá»­, vÃ  chÃºng ta muá»‘n sau khi biáº¿n Ä‘á»•i xong thÃ¬ váº¿ pháº£i pháº£i cÃ³ dáº¡ng giá»‘ng na nÃ¡ váº¿ trÃ¡i, tá»« Ä‘Ã³ ta cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a má»™t hÃ m phá»¥ <span class="math inline">\(F\)</span> nÃ o Ä‘Ã³ sao cho váº¿ trÃ¡i vÃ  váº¿ pháº£i phá»¥ thuá»™c vÃ o nhau thÃ´ng qua <span class="math inline">\(F\)</span>, kiá»ƒu nhÆ° <span class="math inline">\(F(2n) = F(3n-1)\)</span> cháº³ng háº¡n. Rá»“i váº­y ta thá»­ cá»™ng <span class="math inline">\(\operatorname{fib}(n+1)\)</span> vÃ o hai váº¿ xem sao:</p>
<p><span class="math display">\[\operatorname{fib}(n+1) + \operatorname{fib}(n+2) = \operatorname{fib}(n) + 2\cdot \operatorname{fib}(n+1)
\]</span></p>
<p>Hai váº¿ khÃ¡ giá»‘ng nhau rá»“i Ä‘Ã³, <span class="math inline">\(\operatorname{fib}(n+1)\)</span> (váº¿ trÃ¡i) tÆ°Æ¡ng á»©ng vá»›i <span class="math inline">\(\operatorname{fib}(n)\)</span> (váº¿ pháº£i) lÃ  á»•n rá»“i nÃ¨, cÃ²n <span class="math inline">\(\operatorname{fib}(n+2)\)</span> (váº¿ trÃ¡i) tÆ°Æ¡ng á»©ng vá»›i <span class="math inline">\(\operatorname{fib}(n+1)\)</span> (váº¿ pháº£i) thÃ¬ váº«n chÆ°a á»•n vÃ¬ bá»‹ khÃ¡c há»‡ sá»‘, Ä‘á»ƒ kháº¯c phá»¥c chuyá»‡n nÃ y thÃ¬ ta sáº½ Ä‘Æ°a ra má»™t biáº¿n khÃ¡c, gá»i lÃ  biáº¿n <span class="math inline">\(b\)</span> Ä‘i. Giá» ta thá»­ cá»™ng <span class="math inline">\((b-1)\operatorname{fib}(n+2)\)</span> vÃ o hai váº¿ xem sao (má»¥c Ä‘Ã­ch cá»™ng nhÆ° váº­y lÃ  Ä‘á»ƒ <span class="math inline">\(\operatorname{fib}(n+2)\)</span> cÃ³ há»‡ sá»‘ lÃ  <span class="math inline">\(b\)</span>):</p>
<p><span class="math display">\[\operatorname{fib}(n+1) + b\cdot \operatorname{fib}(n+2) = b\cdot \operatorname{fib}(n) + (b+1)\cdot \operatorname{fib}(n+1)
\]</span></p>
<p>Ta nháº­n tháº¥y há»‡ sá»‘ cá»§a <span class="math inline">\(\operatorname{fib}(n+1)\)</span> vÃ  <span class="math inline">\(\operatorname{fib}(n)\)</span> chÆ°a giá»‘ng nhau (bÃªn lÃ  <span class="math inline">\(1\)</span>, bÃªn lÃ  <span class="math inline">\(b\)</span>), nÃªn lÃ  ta Ä‘Æ°a thÃªm biáº¿n <span class="math inline">\(a\)</span> vÃ o vÃ  lÃ m tÆ°Æ¡ng tá»±, ta Ä‘Æ°á»£c:</p>
<p><span class="math display">\[a\cdot \operatorname{fib}(n+1) + b\cdot \operatorname{fib}(n+2) = b\cdot \operatorname{fib}(n) + (a+b)\cdot \operatorname{fib}(n + 1)\tag{4}
\]</span></p>
<p>Tuyá»‡t vá»i Ã´ng máº·t trá»i, hai bÃªn cÃ³ cÃ¹ng má»™t dáº¡ng rá»“i Ä‘Ã³, bÃ¢y giá» ta Ä‘á»‹nh nghÄ©a hÃ m phá»¥ <span class="math inline">\(F\)</span> nhÆ° sau:</p>
<p><span class="math display">\[F(a, b, n) = a\cdot \operatorname{fib}(n) + b\cdot \operatorname{fib}(n+1)
\]</span></p>
<p>Tá»« Ä‘Ã³ ta cÃ³ thá»ƒ biá»ƒu diá»…n hai váº¿ cá»§a <span class="math inline">\((4)\)</span> dÆ°á»›i dáº¡ng:</p>
<p><span class="math display">\[F(a, b, n+1) = F(b, a+b, n) \tag{*}
\]</span></p>
<p>NgoÃ i ra dá»±a vÃ o Ä‘á»‹nh nghÄ©a cá»§a <span class="math inline">\(F\)</span>, ta Ä‘Æ°á»£c:</p>
<p><span class="math display">\[F(a, b, 0) = a\cdot \operatorname{fib}(0) + b\cdot \operatorname{fib}(1) = a + b \tag{5}
\]</span></p>
<p>HÆ¡n ná»¯a:</p>
<p><span class="math display">\[\operatorname{fib}(n) = 1\cdot \operatorname{fib}(n) + 0\cdot \operatorname{fib}(n+1) = F(1, 0, n) \tag{6}
\]</span></p>
<p>Ta Ä‘Ã£ hoÃ n toÃ n cÃ³ Ä‘á»§ nguyÃªn liá»‡u Ä‘á»ƒ triá»ƒn khai thuáº­t toÃ¡n rá»“i Ä‘Ã³, Ä‘á»ƒ Ã½:</p>
<ul>
<li><span class="math inline">\((6)\)</span> cho ta Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a tá»•ng quÃ¡t cá»§a <span class="math inline">\(\operatorname{fib}(n)\)</span> dá»±a trÃªn hÃ m phá»¥ <span class="math inline">\(F\)</span>.</li>
<li><span class="math inline">\((*)\)</span> cho ta cÃ´ng thá»©c Ä‘á»‡ quy cá»§a <span class="math inline">\(F\)</span>.</li>
<li><span class="math inline">\((5)\)</span> cho ta base case Ä‘á»‡ quy cá»§a <span class="math inline">\(F\)</span>.</li>
</ul>
<p>Hy vá»ng tá»›i Ä‘Ã¢y má»i thá»© make sense Ä‘Æ°á»£c vá»›i báº¡n, náº¿u lÃº thÃ¬ cÅ©ng khÃ´ng sao cá»© Ä‘á»c láº¡i nhÃ©, máº¥y láº§n Ä‘áº§u mÃ¬nh Ä‘á»c cÅ©ng lÃº ğŸ™‚ Giá» thÃ¬ code thÃ´i (2 code dÆ°á»›i nÃ y Ä‘á»u lÃ  cá»§a tÃ¡c giáº£ bÃ i toÃ¡n háº¿t nha, khÃ´ng pháº£i cá»§a tui):</p>
<pre><code class="language-python">def fib(n):

    def F(a, b, n):
        if n == 0: return a + b    # see (5) above
        return F(b, a + b, n - 1)  # see (*) above

    return F(1, 0, n)              # see (6) above
</code></pre>
<p>Tá»›i Ä‘Ã¢y lÃ  <span class="math inline">\(QED\)</span> rá»“i, nhÆ°ng náº¿u ngÃ´n ngá»¯ báº¡n dÃ¹ng khÃ´ng há»— trá»£ tá»‘i Æ°u Ä‘á»‡ quy Ä‘uÃ´i (<a href="https://stackoverflow.com/questions/310974/what-is-tail-call-optimization">tail call optimization</a>) thÃ¬ báº¡n cÃ³ thá»ƒ implement theo dáº¡ng khá»­ Ä‘á»‡ quy nhÆ° sau:</p>
<pre><code class="language-python">def fib(n):
    a, b = 1, 0                    # see (6) above
    while n > 0:
        a, b, n = b, a + b, n - 1  # see (*) above
    return a + b .                 # see (5) above
</code></pre>
<blockquote>
ÄÃ¢y lÃ  má»™t sá»©c máº¡nh khÃ¡c cá»§a tail recursion, má»™t khi báº¡n Ä‘Ã£ Ä‘Æ°a hÃ m vá» tail recursion rá»“i thÃ¬ viá»‡c khá»­ Ä‘á»‡ quy lÃ  vÃ´ cÃ¹ng Ä‘Æ¡n giáº£n.
</blockquote>
<p>Tuyá»‡t dá»i, lÃ m â€œtÆ°Æ¡ng tá»±â€ vá»›i hÃ m <span class="math inline">\(\operatorname{fusc}(n)\)</span> thÃ´i nÃ o ğŸ˜‰. Náº¿u Ä‘á»c tá»›i Ä‘Ã¢y mÃ  báº¡n Ä‘Ã£ cÃ³ Ã½ tÆ°á»Ÿng, hoáº·c muá»‘n thá»­ sá»©c báº£n thÃ¢n thÃ¬ cÃ³ thá»ƒ pause láº¡i. Tháº­t ra theo tui thÃ¬ má»™t khi Ä‘Ã£ náº¯m Ä‘Æ°á»£c Ã½ tÆ°á»Ÿng cá»§a phÆ°Æ¡ng phÃ¡p nÃ y rá»“i thÃ¬ cÅ©ng khÃ´ng quÃ¡ khÃ³ Ä‘Ã¢u.</p>
<h2>Giáº£i quyáº¿t bÃ i toÃ¡n</h2>
<p>Nháº¯c láº¡i Ä‘á»‹nh nghÄ©a cá»§a hÃ m <span class="math inline">\(\operatorname{fusc}(n)\)</span>. Äá»ƒ cho <del>gÃµ Ä‘á»¡ má»i tay</del> Ä‘Æ¡n giáº£n thÃ¬ tui Ä‘áº·t hÃ m <span class="math inline">\(\operatorname{fusc}(n)\)</span> lÃ  hÃ m <span class="math inline">\(f(n)\)</span> luÃ´n nhÃ©:</p>
<p><span class="math display">\[\begin{cases}
f(0) = 0 & (1)\\
f(1) = 1 & (2)\\
f(2n) = f(n) & (3)\\
f(2n + 1) = f(n) + f(n + 1) & (4)\\
\end{cases}
\]</span></p>
<p>TÆ°Æ¡ng tá»± nhÆ° vÃ­ dá»¥ trÃªn, tá»« Ä‘á»‹nh nghÄ©a ta sáº½ cá»‘ gáº¯ng tÃ¬m phÆ°Æ¡ng trÃ¬nh nÃ o Ä‘Ã³ sao cho hai váº¿ cÃ³ cÃ¹ng dáº¡ng, rá»“i tá»« Ä‘Ã³ Ä‘áº·t hÃ m phá»¥. Láº¥y <span class="math inline">\((3)\)</span> vÃ  <span class="math inline">\((4)\)</span> cá»™ng láº¡i vá»›i nhau thá»­ coi sao:</p>
<p><span class="math display">\[f(2n)+f(2n+1)=2f(n) + f(n+1)
\]</span></p>
<p>Tháº¥y hai váº¿ cÅ©ng na nÃ¡ giá»‘ng rá»“i nÃ¨, <span class="math inline">\(f(2n)\)</span> tÆ°Æ¡ng á»©ng vá»›i <span class="math inline">\(f(n)\)</span> vÃ  <span class="math inline">\(f(2n+1)\)</span> tÆ°Æ¡ng á»©ng vá»›i <span class="math inline">\(f(n+1)\)</span>. BÃ¢y giá» tÃ¬m cÃ¡ch cÃ¢n báº±ng há»‡ sá»‘ thÃ´i. Cá»¥ thá»ƒ, ta sáº½ Ä‘Æ°a biáº¿n <span class="math inline">\(b\)</span> vÃ o phÆ°Æ¡ng trÃ¬nh báº±ng cÃ¡ch cá»™ng <span class="math inline">\((b-1)f(2n+1)\)</span> hai váº¿, ta Ä‘Æ°á»£c:</p>
<p><span class="math display">\[f(2n)+bf(2n+1)=(b+1)f(n) + bf(n+1)
\]</span></p>
<p>TÆ°Æ¡ng tá»±, Ä‘Æ°a biáº¿n <span class="math inline">\(a\)</span> vÃ o phÆ°Æ¡ng trÃ¬nh:</p>
<p><span class="math display">\[af(2n)+bf(2n+1)=(a+b)f(n) + bf(n+1) \tag{5}
\]</span></p>
<p>Hai váº¿ Ä‘Ã£ cÃ¹ng dáº¡ng nhÆ° mÃ¬nh ao Æ°á»›c rá»“i Ä‘Ã³, giá» Ä‘á»‹nh nghÄ©a hÃ m phá»¥ <span class="math inline">\(F\)</span> thÃ´i:</p>
<p><span class="math display">\[F(a, b, n) = af(n) + bf(n+1)
\]</span></p>
<p>Tá»« Ä‘Ã³ ta biá»ƒu diá»…n <span class="math inline">\((5)\)</span> theo <span class="math inline">\(F\)</span> nhÆ° sau:</p>
<p><span class="math display">\[F(a,b,2n) = F(a+b,b,n) \tag{*}
\]</span></p>
<p>NgoÃ i ra tá»« Ä‘á»‹nh nghÄ©a cá»§a <span class="math inline">\(F\)</span> suy ra Ä‘Æ°á»£c:</p>
<p><span class="math display">\[F(a,b,0) = af(0) + bf(1) = b \tag{6.1}
\]</span></p>
<p>VÃ :</p>
<p><span class="math display">\[F(a,b,1) = af(1) + bf(2) = a + b \tag{6.2}
\]</span></p>
<p>HÆ¡n ná»¯a:</p>
<p><span class="math display">\[f(n) = 1f(n) + 0f(n+1) = F(1,0,n) \tag{7}
\]</span></p>
<p>Ngá»«ng láº¡i má»™t chÃºt, tá»›i Ä‘Ã¢y ta váº«n chÆ°a thá»ƒ triá»ƒn khai thÃ nh thuáº­t toÃ¡n hoÃ n chá»‰nh Ä‘Æ°á»£c, táº¡i sao Æ°? Äá»ƒ Ã½ <span class="math inline">\((*)\)</span> chá»‰ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a vá»›i <span class="math inline">\(2n\)</span>, tá»©c khi input lÃ  sá»‘ cháºµn, váº­y cÃ²n láº» thÃ¬ sao? ÄÆ¡n giáº£n thÃ´i, tháº¿ trÆ°á»ng há»£p input láº» vÃ o <span class="math inline">\(F\)</span> rá»“i biáº¿n Ä‘á»•i, tá»©c lÃ :</p>
<p><span class="math display">\[\begin{align*}
F(a,b,2n+1)
&= af(2n+1) + bf(n+1)\\
&= a[f(n) + f(n+1)] + bf(n+1)\\
&= af(n) + (a+b)f(n+1)\\
&= F(a,a+b,n) \tag{**}
\end{align*}
\]</span></p>
<p>Ta tá»•ng há»£p láº¡i Ä‘Æ°á»£c nhÆ° sau:</p>
<ul>
<li><span class="math inline">\((7)\)</span> cho ta Ä‘á»‹nh nghÄ©a tá»•ng quÃ¡t cá»§a <span class="math inline">\(f(n)\)</span> dá»±a trÃªn <span class="math inline">\(F\)</span>.</li>
<li><span class="math inline">\((*)\)</span> cho ta cÃ´ng thá»©c Ä‘á»‡ quy cá»§a <span class="math inline">\(F\)</span> Ä‘á»‘i vá»›i trÆ°á»ng há»£p input cháºµn, tÆ°Æ¡ng tá»± vá»›i <span class="math inline">\((**)\)</span> á»Ÿ trÆ°á»ng há»£p input láº».</li>
<li><span class="math inline">\((6.1)\)</span> vÃ  <span class="math inline">\((6.2)\)</span> cho ta base case Ä‘á»‡ quy cá»§a <span class="math inline">\(F\)</span>.</li>
</ul>
<p>Code thoai:</p>
<pre><code class="language-js">function fusc(n) {

    function F(a, b, k) {
        if (k === 0)  // See (6.1)
            return b
        else if (k === 1)  // See (6.2)
            return a + b
        else if (k % 2 === 0)  // See (*)
            return F(a+b, b, Math.round(k / 2))
        else  // See (**)
            return F(a, a+b, Math.round((k-1) / 2))
    }

    return F(1, 0, n)  // See (7)
}
</code></pre>
<p>Submit thá»­:<br>
<img src="https://i.imgur.com/yoKDKTn.png" alt="submit-code-img"><br>
Ngon lÃ nh chá»© háº£, bonus cho máº¥y báº¡n thÃªm code Haskell nÃ¨:</p>
<pre><code class="language-haskell">fusc :: Integer -> Integer
fusc n = aux 1 0 n
  where
    aux _ b 0 = b
    aux a b 1 = a+b
    aux a b n
      | even n = aux (a+b) b (n `div` 2)
      | otherwise = aux a (a+b) ((n-1) `div` 2)
</code></pre>
<p>Tui biáº¿t cÃ³ má»™t sá»‘ báº¡n Ä‘á»c tá»›i Ä‘Ã¢y rá»“i thÃ¬ ngá»©a láº¯m, cÃ³ thá»ƒ báº¡n sáº½ tháº¯c máº¯c táº¡i sao khÃ´ng dÃ¹ng quy hoáº¡ch Ä‘á»™ng? ThÃ¬ Ä‘áº§u tiÃªn lÃ  tui Ä‘ang muá»‘n nháº¥n máº¡nh vá» phÆ°Æ¡ng phÃ¡p nÃ y, nÃªn quy hoáº¡ch Ä‘á»™ng khÃ´ng náº±m trong khuÃ´n khá»• cá»§a bÃ i viáº¿t. Thá»© 2 lÃ  quy hoáº¡ch Ä‘á»™ng tháº­t ra cÅ©ng khÃ´ng hiá»‡u quáº£ báº±ng Ä‘Ã¢u, tui cÅ©ng cÃ³ thá»­ implement quy hoáº¡ch Ä‘á»™ng xong submit thá»­ rá»“i nhÆ°ng nÃ³ tá»‘n quÃ¡ nhiá»u bá»™ nhá»›, codewars khÃ´ng accept (ngÆ°á»i ta tÃ­nh háº¿t rá»“i ^^).</p>
<h2>GÃ³c nhÃ¬n cá»§a tui vá» phÆ°Æ¡ng phÃ¡p nÃ y</h2>
<p>Trong pure functional programming language (FP) nhÆ° Haskell thÃ¬ khÃ´ng cÃ³ vÃ²ng láº·p cho báº¡n dÃ¹ng, thay vÃ o Ä‘Ã³ náº¿u báº¡n muá»‘n láº·p thÃ¬ báº¡n pháº£i xÃ¢y dá»±ng Ä‘á»‡ quy. MÃ  thá»±c táº¿ cÃ³ nhá»¯ng tÃ­nh nÄƒng báº¡n cáº§n láº·p vÃ´ háº¡n hoáº·c láº·p ráº¥t nhiá»u láº§n, Ä‘á»ƒ khÃ´ng bá»‹ stack overflow trÃªn nhá»¯ng tÃ­nh nÄƒng Ä‘Ã³ thÃ¬ há» pháº£i hÆ°á»›ng tá»›i tail recursion. Váº­y lÃ m sao Ä‘á»ƒ xÃ¢y dá»±ng tail recursion? á»«a thÃ¬ linh cáº£m, tÃ¢m linh lÃ  chÃ­nh thÃ´i, láº¥y vÃ­ dá»¥ cho hÃ m tÃ­nh giai thá»«a:</p>
<pre><code class="language-js">// Äá»‡ quy thÃ´ng thÆ°á»ng
function fact(n) {
    if (n === 1)
        return 1
    else
        return n * fact(n-1)
}

// Tail recursion
function fact(n, acc) {
    if (n === 1)
        return acc
    else
        return fact(n-1, acc*n)
}
fact(10, 1) // tÃ­nh 10!
</code></pre>
<p>HÃ m Ä‘á»‡ quy thÃ´ng thÆ°á»ng thÃ¬ Ä‘Æ¡n giáº£n rá»“i mÃ¬nh sáº½ khÃ´ng nháº¯c tá»›i nhÃ©. CÃ²n pháº§n tail recursion á»Ÿ dÆ°á»›i mÃ¬nh cÃ³ thá»ƒ hiá»ƒu lÃ  ta cáº§n 1 biáº¿n nhÃ¢n dá»“n káº¿t quáº£ láº¡i, gá»i lÃ  <code>acc</code> (accumulator). <code>acc</code> cÃ³ giÃ¡ trá»‹ ban Ä‘áº§u lÃ  1, má»—i láº§n gá»i Ä‘á»‡ quy thÃ¬ ta nhÃ¢n <code>n</code> vÃ´ <code>acc</code>, Ä‘á»“ng thá»i giáº£m <code>n</code> xuá»‘ng má»™t Ä‘Æ¡n vá»‹, rá»“i truyá»n vÃ o Ä‘á»‡ quy káº¿ tiáº¿p. Cá»© truyá»n xuá»‘ng nhÆ° váº­y, lÃºc nÃ y báº¡n sáº½ tháº¥y <code>acc</code> mang giÃ¡ trá»‹ cá»§a tÃ­ch <code>n(n-1)(n-2)...</code> vÃ  cÅ©ng lÃ  káº¿t quáº£ mÃ¬nh cáº§n tÃ¬m khi <code>n</code> giáº£m xuá»‘ng 1.</p>
<p>ÄÃ¢y cÅ©ng lÃ  pattern chung trong phÆ°Æ¡ng phÃ¡p tÃ¬m tail recursion, ta sáº½ cÃ³ biáº¿n tÃ­ch luá»¹ <code>acc</code> lÃ  tham sá»‘ Ä‘Æ°á»£c truyá»n dáº§n xuá»‘ng, vÃ  nÃ³ sáº½ Ä‘em theo káº¿t quáº£ cho Ä‘áº¿n khi cháº¡m base case. NhÆ°ng ta cÃ³ thá»ƒ tháº¥y pattern trÃªn chá»‰ do mÃ¬nh cáº£m giÃ¡c vÃ  tÆ°á»Ÿng tÆ°á»£ng (aka tÃ¢m linh) chá»© khÃ´ng Ä‘Æ°á»£c chá»©ng minh rÃµ rÃ ng, vÃ  ban Ä‘áº§u mÃ¬nh cÅ©ng nghÄ© máº¥y thá»© nÃ y khÃ´ng thá»ƒ chá»©ng minh Ä‘Æ°á»£c cho Ä‘áº¿n khi gáº·p bÃ i toÃ¡n xá»‹n xÃ² mÃ  mÃ¬nh Ä‘Ã£ giáº£i quyáº¿t bÃªn trÃªn.</p>
<blockquote>
GÃ³c bÃ i táº­p vá» nhÃ : Báº¡n cÃ³ thá»ƒ thá»­ suy nghÄ© cÃ¡ch chá»©ng minh Ä‘á»‹nh nghÄ©a hÃ m fact(n, acc) bÃªn trÃªn lÃ  Ä‘Ãºng dá»±a trÃªn phÆ°Æ¡ng phÃ¡p cháº·t cháº½ cá»§a bÃ i viáº¿t. VÃ  xÃ¢y dá»±ng láº¡i tail recursion cho fib(n) dá»±a trÃªn phÆ°Æ¡ng phÃ¡p tÃ¢m linh nÃ y, báº¡n sáº½ báº¥t ngá» vÃ¬ nÃ³ cho cÃ¹ng má»™t káº¿t quáº£ Ä‘Ã³.
</blockquote>
<p>Cáº£m Æ¡n máº¥y báº¡n Ä‘Ã£ Ä‘á»c háº¿t Ä‘áº¿n Ä‘Ã¢y (hoáº·c lÃ  do báº¡n lÆ°á»›t xuá»‘ng vÃ  gáº·p Ä‘Æ°á»£c dÃ²ng nÃ y). ÄÃ¢y lÃ  bÃ i viáº¿t Ä‘áº§u tiÃªn trÃªn blog cá»§a tui, tui xin nháº­n má»i Ã½ kiáº¿n Ä‘Ã³ng gÃ³p, nhÆ°ng náº¿u báº¡n cÃ³ Ã½ Ä‘á»‹nh nÃ©m Ä‘Ã¡ thÃ¬ nÃªn cÃ¢n nháº¯c lá»i láº½ phÃ¹ há»£p vá»›i trÃ¡i tim má»ng manh cá»§a tÃ¡c giáº£ ğŸ˜¢.</p>
</div> <div class="post-hashtag-container"><div class="tag-title"><p>Tags:</p></div> <div><a href="/?tags=algorithm" class="hashtag" data-v-578e9d56>
        #algorithm
    </a><a href="/?tags=recursion" class="hashtag" data-v-578e9d56>
        #recursion
    </a><a href="/?tags=functional-programming" class="hashtag" data-v-578e9d56>
        #functional-programming
    </a></div></div></div> <div class="comment-section"><div class="comment-divider"></div> <div class="comment-input-container"><!----> <div class="comment-login"><p>Tham gia bÃ¬nh luáº­n vá»›i</p> <button class="comment-login-site"><i class="fab fa-github"></i></button> <p>hoáº·c</p> <button class="comment-login-site"><i class="fab fa-google"></i></button></div></div> <div class="comment-list"></div></div></div> <div id="footer"><p id="footer-text">
        Created by
            <a href="https://www.facebook.com/100007015541619" target="_blank"><span></span></a>
        with
        <span id="footer-emoji-heart" class="fas fa-heart"></span>
        and some 
        <span id="footer-emoji-tear" class="fas fa-tint"></span></p></div></article></div></div></div><script defer src="/_nuxt/static/1685628949/posts/interesting-tail-call-elimination-problem/state.js"></script><script src="/_nuxt/2d9de3f.js" defer></script><script src="/_nuxt/a041fa1.js" defer></script><script src="/_nuxt/2724976.js" defer></script><script src="/_nuxt/2d0a0ae.js" defer></script><script src="/_nuxt/8538b13.js" defer></script><script src="/_nuxt/0a5dc33.js" defer></script><script src="/_nuxt/761ab04.js" defer></script>
  </body>
</html>
